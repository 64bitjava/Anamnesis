<UserControl x:Class="Anamnesis.PoseModule.Pages.PosePage"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
			 xmlns:local="clr-namespace:Anamnesis.PoseModule"
			 xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
			 xmlns:controls="clr-namespace:Anamnesis.PoseModule.Controls"
			 xmlns:views="clr-namespace:Anamnesis.PoseModule.Views"
			 xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
			 xmlns:anaConverters="clr-namespace:Anamnesis.Styles.Converters"
			 xmlns:ana="clr-namespace:Anamnesis.Styles.Controls"
			 mc:Ignorable="d" 
			 Loaded="OnLoaded"
			 DataContextChanged="OnDataContextChanged"
			 d:DesignHeight="512" d:DesignWidth="1024">

	<Grid x:Name="ContentArea">

		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition />
				<ColumnDefinition Width="220"/>
			</Grid.ColumnDefinitions>

			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition />
			</Grid.RowDefinitions>

			<!-- Sidebar -->
			<Grid Grid.Column="2" Grid.Row="0" Grid.RowSpan="2">
				<Grid.RowDefinitions>
					<RowDefinition/>
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>

				<Border Grid.Row="0" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="3" Margin="3">

					<StackPanel Orientation="Vertical">

						<ana:TextBlock Key="{Binding Skeleton.CurrentBone.TooltipKey, FallbackValue=Pose_CharacterRoot}" HorizontalAlignment="Center" Margin="3"/>

						<Grid>
							<controls:TransformEditor Value="{Binding Skeleton.CurrentBone}" Visibility="{Binding Skeleton.CurrentBone, Converter={StaticResource NotNullToVisibilityConverter}}"/>

							<Grid Visibility="{Binding Skeleton.CurrentBone, Converter={StaticResource NullToVisibilityConverter}}">
								<controls:TransformEditor Value="{Binding TargetService.SelectedActor.ModelObject.Transform}"/>
							</Grid>
						</Grid>
					</StackPanel>

				</Border>

				<Border Grid.Row="1" Grid.ColumnSpan="2" Background="{StaticResource MaterialDesignCardBackground}" CornerRadius="3" IsEnabled="{Binding GposeService.IsGpose}" Margin="3">
					<Grid Margin="3">
						<Grid.RowDefinitions>
							<RowDefinition/>
							<RowDefinition/>
							<RowDefinition/>
						</Grid.RowDefinitions>

						<CheckBox Content="Include Selected Bones Only" Grid.ColumnSpan="3" Margin="3" IsChecked="{Binding FileConfiguration.UseSelection}"/>

						<Grid Grid.Row="1" Margin="3">
							<Grid.ColumnDefinitions>
								<ColumnDefinition/>
								<ColumnDefinition/>
								<ColumnDefinition/>
							</Grid.ColumnDefinitions>

							<CheckBox Grid.Column="0" Content="Rotation" IsChecked="{Binding FileConfiguration.IncludeRotation}"/>
							<CheckBox Grid.Column="1" Content="Position" IsChecked="{Binding FileConfiguration.IncludePosition}"/>
							<CheckBox Grid.Column="2" Content="Scale" IsChecked="{Binding FileConfiguration.IncludeScale}"/>
						</Grid>

						<Grid Grid.Row="2" Margin="0, 3, 0, 0">
							<Grid.ColumnDefinitions>
								<ColumnDefinition/>
								<ColumnDefinition/>
							</Grid.ColumnDefinitions>

							<ana:IconButton Grid.Column="0" Icon="Upload" Text="Load..." Margin="3" Click="OnOpenClicked"/>
							<ana:IconButton Grid.Column="1" Icon="Download" Text="Save..." Margin="3" Click="OnSaveClicked"/>
						</Grid>

					</Grid>
				</Border>
			</Grid>

			<!-- top Bar -->
			<Border Grid.Row="0" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="3" VerticalAlignment="Stretch" Margin="3" IsEnabled="{Binding GposeService.IsGpose}">
				<Grid Height="35">
					<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
						<ToggleButton IsChecked="{Binding PoseService.IsEnabled}" Style="{StaticResource OutlineToggleButton}" Margin="3" Width="75">
							<Grid>
								<ana:TextBlock Key="Common_Disable" Margin="12,0,12,0" Visibility="{Binding PoseService.IsEnabled, Converter={StaticResource B2V}}"/>
								<ana:TextBlock Key="Common_Enable" Margin="12,0,12,0" Visibility="{Binding PoseService.IsEnabled, Converter={StaticResource !B2V}}"/>
							</Grid>
						</ToggleButton>

						<Line Y1="0" Y2="1" Stretch="Fill" Stroke="{StaticResource MaterialDesignPaper}" StrokeThickness="1" Margin="3"/>

						<ListBox Style="{StaticResource MaterialDesignToolToggleListBox}" x:Name="ViewSelector" SelectedIndex="0" Margin="6, 6, 6, 4" SelectionChanged="OnViewChanged">
							<ListBoxItem ToolTip="GUI View" Margin="1, 1, 0, 1" Padding="12, 4, 12, 4" Cursor="Hand">
								<fa:IconImage Icon="ProjectDiagram" Foreground="{DynamicResource MaterialDesignBody}"/>
							</ListBoxItem>
							<ListBoxItem ToolTip="Matrix View" Margin="0, 1, 1, 1" Padding="12, 4, 12, 4" Cursor="Hand">
								<fa:IconImage Icon="BorderAll" Foreground="{DynamicResource MaterialDesignBody}"/>
							</ListBoxItem>
							<!--<ListBoxItem x:Name="View3dButton" ToolTip="3D View" Margin="0, 1, 1, 1" Padding="12, 4, 12, 4" Cursor="Hand">
								<fa:IconImage Icon="Cube" Foreground="{DynamicResource MaterialDesignBody}"/>
							</ListBoxItem>-->
						</ListBox>

						<Line Y1="0" Y2="1" Stretch="Fill" Stroke="{StaticResource MaterialDesignPaper}" StrokeThickness="1" Margin="3"/>

						<CheckBox IsChecked="{Binding PoseService.FreezePhysics}" VerticalContentAlignment="Center" Margin="3, 0, 3, 0" IsEnabled="{Binding PoseService.IsEnabled}">
							<ana:TextBlock Key="Pose_FreezePhysics"/>
						</CheckBox>

						<CheckBox IsChecked="{Binding Skeleton.LinkEyes}" VerticalContentAlignment="Center" Margin="3, 0, 3, 0" IsEnabled="{Binding PoseService.IsEnabled}">
							<ana:TextBlock Key="Pose_LinkEyes"/>
						</CheckBox>

					</StackPanel>

					<StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
						<Button Style="{StaticResource TransparentButton}" Margin="6" IsEnabled="{Binding Skeleton.HasSelection}" Click="OnClearClicked">
							<ana:TextBlock Text="Clear Selection" Margin="6, 0, 6, 0"/>
						</Button>
						
						<Button Style="{StaticResource TransparentButton}" Margin="6" IsEnabled="{Binding Skeleton.HasSelection}" Click="OnSelectChildrenClicked">
							<ana:TextBlock Text="Select Children" Margin="6, 0, 6, 0"/>
						</Button>
					</StackPanel>
				</Grid>
			</Border>

			

			<!-- Content -->
			<Border Grid.Row="1" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="3" Margin="3">
				<Grid IsEnabled="{Binding PoseService.IsEnabled}">

					<Grid Grid.Row="1" x:Name="MouseCanvas" MouseDown="OnCanvasMouseDown" MouseMove="OnCanvasMouseMove" MouseUp="OnCanvasMouseUp" Background="Transparent">
						<Grid DataContext="{Binding Skeleton}">
							<!--<views:Pose3DView x:Name="ThreeDView" Visibility="Collapsed"/>-->
							<views:PoseGuiView x:Name="GuiView" Visibility="Visible"/>
							<views:PoseMatrixView x:Name="MatrixView" Visibility="Collapsed"/>
						</Grid>
					</Grid>

					<Canvas Grid.Row="1" x:Name="SelectionCanvas" IsHitTestVisible="False">
						<Border 
							x:Name="DragSelectionBorder"
							Visibility="Collapsed"
							BorderBrush="{DynamicResource PrimaryHueMidBrush}"
							BorderThickness="1"
							CornerRadius="3">
							<Border Background="{DynamicResource MaterialDesignBackground}" Opacity="0.1"/>
						</Border>
					</Canvas>

				</Grid>
			</Border>

			<Grid Grid.Row="0" Grid.RowSpan="2" Visibility="{Binding GposeService.IsGpose, Converter={StaticResource !B2V}}">
				<Rectangle Fill="{StaticResource MaterialDesignPaper}" Opacity="0.75"/>
				<StackPanel Height="32" HorizontalAlignment="Center" Orientation="Horizontal">
					<fa:IconImage Icon="ExclamationTriangle" Foreground="{DynamicResource MaterialDesignBody}" Margin="6, 3, 10, 3"/>
					<ana:TextBlock Key="Pose_WarningNotGPose" FontSize="14" VerticalAlignment="Center" Foreground="{DynamicResource MaterialDesignBody}"/>
				</StackPanel>
			</Grid>
		</Grid>

		

	</Grid>
</UserControl>
